(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2774],{5235:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/frontend/debounce",function(){return t(7609)}])},7609:function(n,e,t){"use strict";t.r(e),t.d(e,{__N_SSG:function(){return h},default:function(){return v},description:function(){return g},frontMatter:function(){return x},tag:function(){return b},title:function(){return m},updated:function(){return y}});var r=t(4246),c=t(1670),s=t(53),o=t(7667),i=t(5360),u=function(){var n=(0,s._)((0,o.useState)(""),2),e=n[0],t=n[1],c=(0,s._)((0,i.Nr)(function(n){t(n.target.value)},500),1)[0];return(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{onChange:c,type:"text"}),(0,r.jsxs)("p",{children:["results: ",e]})]})},a=t(851);function l(){var n=(0,a._)(["\n  margin: 0 0 20px 0;\n  & > *:not(:first-child) {\n    margin-left: 10px;\n  }\n"]);return l=function(){return n},n}var d=t(7149).ZP.div.withConfig({componentId:"sc-2e561aeb-0"})(l()),p=function(){var n=(0,i.Tg)(function(n){return function(e){console.log(e),n(function(){console.log("Complete!")})}},[]),e=(0,o.useCallback)(function(e){for(var t=1;t<=e;t+=1)n(t)},[n]);return(0,r.jsxs)(d,{children:[(0,r.jsx)("button",{onClick:function(){return e(5)},children:"5次打印"}),(0,r.jsx)("button",{onClick:function(){return e(10)},children:"10次打印"})]})},f=t(5685),h=!0,x={title:"debounce 去抖",description:"前端防抖实现",tag:["web前端"],updated:"2023-02-22T07:57:53.000Z"},m="debounce 去抖",g="前端防抖实现",b=["web前端"],y="2023-02-22T07:57:53.000Z",j=function(n){return(0,r.jsx)(f.s,n)};function T(n){var e=Object.assign({h1:"h1",pre:"pre",code:"code",h2:"h2"},(0,c.ah)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"常见的防抖实现",children:"常见的防抖实现"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"import { useMemo, useRef } from 'react';\n\nexport function debounce<T extends (...args: any[]) => any>(fn: T, delay: number) {\n  let timer: number;\n  const cancel = () => {\n    window.clearTimeout(timer);\n  };\n  const callback = (...args: any[]) => {\n    cancel();\n    timer = window.setTimeout(() => {\n      fn(...args);\n    }, delay);\n  };\n  return [callback, cancel];\n}\n\nexport const useDebounce = <T extends (...args: any[]) => any>(fn: T, delay = 500) => {\n  const ref = useRef<T>();\n  ref.current = fn;\n  return useMemo(() => {\n    return debounce((...args: any[]) => {\n      ref.current?.(...args);\n    }, delay);\n  }, [delay]) as [T, () => void];\n};\n"})}),"\n",(0,r.jsx)(e.h2,{id:"应用",children:"应用"}),"\n",(0,r.jsx)(u,{}),"\n",(0,r.jsxs)("details",{children:[(0,r.jsx)("summary",{children:"代码"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"import { ChangeEvent, FC, useState } from 'react';\nimport { useDebounce } from '@shared/utils';\n\nexport const DebounceExample: FC = () => {\n\n  const [result, setResult] = useState('');\n  const [handleChange] = useDebounce((e: ChangeEvent<HTMLInputElement>) => {\n    setResult(e.target.value);\n  }, 500);\n\n  return (\n    <div>\n      <input onChange={handleChange} type=\"text\"/>\n      <p>results: { result }</p>\n    </div>\n  );\n};\n"})})]}),"\n",(0,r.jsx)(e.h1,{id:"其他",children:"其他"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"import { DependencyList, useMemo } from 'react';\n\ninterface FNFactory<T>{\n  (callback: (post: () => any) => void): T;\n}\nexport function trailed<T extends (...args: any[]) => any>(fn: FNFactory<T>): T {\n  let count = 0;\n  const callback = (post: () => any) => {\n    count += 1;\n    Promise.resolve().then(() => {\n      if (count > 1) return count -= 1;\n      count = 0;\n      post();\n    });\n  };\n  return fn(callback);\n}\n\nexport const useTrailed = <T extends (...args: any[]) => any>(fn: FNFactory<T>, deps: DependencyList) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useMemo(() => trailed(fn), deps);\n};\n"})}),"\n",(0,r.jsx)(e.h2,{id:"示例",children:"示例"}),"\n",(0,r.jsx)(p,{}),"\n",(0,r.jsxs)("details",{children:[(0,r.jsx)("summary",{children:"代码"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"import { FC, useCallback } from 'react';\nimport { useTrailed } from '@shared/utils';\nimport styled from 'styled-components';\n\nconst Wrapper = styled.div`\n  margin: 0 0 20px 0;\n  & > *:not(:first-child) {\n    margin-left: 10px;\n  }\n`;\nexport const TrailedExample: FC = () => {\n\n  const counting = useTrailed((callback) => {\n    return (num: number) => {\n      // eslint-disable-next-line no-console\n      console.log(num);\n      callback(() => {\n        // eslint-disable-next-line no-console\n        console.log('Complete!');\n      });\n    };\n  }, []);\n  \n  const count = useCallback((len: number) => {\n    for (let i = 1; i <= len; i += 1) {\n      counting(i);\n    }\n  }, [counting]);\n\n  return (\n    <Wrapper>\n      <button onClick={() => count(5)}>5次打印</button>\n      <button onClick={() => count(10)}>10次打印</button>\n    </Wrapper>\n  );\n};\n"})})]})]})}var v=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.jsx)(j,Object.assign({},n,{children:(0,r.jsx)(T,n)}))}},3121:function(n){"use strict";n.exports=ReactTransitionGroup},9378:function(n){"use strict";n.exports=algoliasearch},7513:function(n){"use strict";n.exports=rxjs}},function(n){n.O(0,[9894,2128,3554,5685,9774,2888,179],function(){return n(n.s=5235)}),_N_E=n.O()}]);