(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7798],{4024:function(n,e,t){"use strict";let r;t.d(e,{Z:function(){return S}});var s=t(42),i=t.n(s),a=t(7406),o=t(7667),l=t.n(o),c=t(8554);let u=()=>(0,c.Z)()&&window.document.documentElement,p=()=>{if(!u())return!1;if(void 0!==r)return r;let n=document.createElement("div");return n.style.display="flex",n.style.flexDirection="column",n.style.rowGap="1px",n.appendChild(document.createElement("div")),n.appendChild(document.createElement("div")),document.body.appendChild(n),r=1===n.scrollHeight,document.body.removeChild(n),r};var d=()=>{let[n,e]=o.useState(!1);return o.useEffect(()=>{e(p())},[]),n},h=t(6775),m=t(1630);let f=l().createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),x=f.Provider;function g(n){let{className:e,direction:t,index:r,marginDirection:s,children:i,split:a,wrap:l,style:c}=n,{horizontalSize:u,verticalSize:p,latestIndex:d,supportFlexGap:h}=o.useContext(f),m={};return(!h&&("vertical"===t?r<d&&(m={marginBottom:u/(a?2:1)}):m=Object.assign(Object.assign({},r<d&&{[s]:u/(a?2:1)}),l&&{paddingBottom:p})),null==i)?null:o.createElement(o.Fragment,null,o.createElement("div",{className:e,style:Object.assign(Object.assign({},m),c)},i),r<d&&a&&o.createElement("span",{className:`${e}-split`,style:m},a))}var j=t(1977),y=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&0>e.indexOf(r)&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)0>e.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};let v={small:8,middle:16,large:24},w=o.forwardRef((n,e)=>{var t,r;let{getPrefixCls:s,space:l,direction:c}=o.useContext(h.E_),{size:u=(null==l?void 0:l.size)||"small",align:p,className:m,rootClassName:f,children:w,direction:S="horizontal",prefixCls:C,split:k,style:b,wrap:T=!1,classNames:P,styles:N}=n,E=y(n,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),B=d(),[_,z]=o.useMemo(()=>(Array.isArray(u)?u:[u,u]).map(n=>"string"==typeof n?v[n]:n||0),[u]),O=(0,a.Z)(w,{keepEmpty:!0}),L=void 0===p&&"horizontal"===S?"center":p,R=s("space",C),[Z,F]=(0,j.Z)(R),$=i()(R,F,`${R}-${S}`,{[`${R}-rtl`]:"rtl"===c,[`${R}-align-${L}`]:L},null!=m?m:null==l?void 0:l.className,f),A=i()(`${R}-item`,null!==(t=null==P?void 0:P.item)&&void 0!==t?t:null===(r=null==l?void 0:l.classNames)||void 0===r?void 0:r.item),I="rtl"===c?"marginLeft":"marginRight",D=0,G=O.map((n,e)=>{var t,r;null!=n&&(D=e);let s=n&&n.key||`${A}-${e}`;return o.createElement(g,{className:A,key:s,direction:S,index:e,marginDirection:I,split:k,wrap:T,style:null!==(t=null==N?void 0:N.item)&&void 0!==t?t:null===(r=null==l?void 0:l.styles)||void 0===r?void 0:r.item},n)}),q=o.useMemo(()=>({horizontalSize:_,verticalSize:z,latestIndex:D,supportFlexGap:B}),[_,z,D,B]);if(0===O.length)return null;let H={};return T&&(H.flexWrap="wrap",B||(H.marginBottom=-z)),B&&(H.columnGap=_,H.rowGap=z),Z(o.createElement("div",Object.assign({ref:e,className:$,style:Object.assign(Object.assign(Object.assign({},H),null==l?void 0:l.style),b)},E),o.createElement(x,{value:q},G)))});w.Compact=m.ZP;var S=w},5641:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/react/use-transition",function(){return t(5706)}])},5706:function(n,e,t){"use strict";t.r(e),t.d(e,{__N_SSG:function(){return S},default:function(){return B},description:function(){return b},frontMatter:function(){return C},tag:function(){return T},title:function(){return k},updated:function(){return P}});var r=t(4246),s=t(1670),i=t(53),a=t(7667),o=t(8062),l=function(n){for(var e=n.children,t=(0,a.useRef)(Date.now());Date.now()-t.current<10;);return(0,r.jsx)("span",{children:e})},c=(0,a.memo)(function(){return(0,r.jsx)(r.Fragment,{children:Array(200).fill(1).map(function(n,e){return(0,r.jsx)(l,{children:e},e)})})});c.displayName="SlowList";var u=function(){var n=(0,i._)((0,a.useState)(!1),2),e=n[0],t=n[1],s=(0,i._)((0,a.useTransition)(),2),l=s[0],u=s[1];return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(o.ZP,{onClick:function(){return t(!0)},children:"展示列表(同步渲染)"}),(0,r.jsx)("span",{children:"同步的按钮点击后，rerender过程同步执行，所以浏览器会卡死5秒钟"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.ZP,{onClick:function(){u(function(){return t(!0)})},children:"展示列表(startTransition)"}),(0,r.jsx)("span",{children:"".concat(l)}),(0,r.jsx)(o.ZP,{onClick:function(){return t(!1)},children:"隐藏列表"}),(0,r.jsx)("span",{children:"使用startTransition，rerender过程异步执行，可以随时中断rerender过程"})]}),e?(0,r.jsx)(c,{}):null]})},p=t(5360),d=t(4024),h=(0,a.lazy)(function(){return t.e(6998).then(t.bind(t,6998)).then(function(n){return(0,p._v)(2e3).then(function(){return n})})}),m=function(){var n=(0,i._)((0,a.useState)(!1),2),e=n[0],t=n[1],s=(0,i._)((0,a.useTransition)(),2),l=s[0],c=s[1];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsxs)(d.Z,{children:[(0,r.jsx)(o.ZP,{onClick:function(){return t(!0)},children:"显示"}),(0,r.jsx)(o.ZP,{onClick:function(){return t(!1)},children:"隐藏"}),(0,r.jsx)(o.ZP,{onClick:function(){c(function(){return t(!0)})},children:"显示（startTransition）"}),(0,r.jsx)("span",{children:"".concat(l)})]})}),(0,r.jsx)("hr",{}),(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("span",{children:"loading..."}),children:e?(0,r.jsx)(h,{}):(0,r.jsx)("span",{children:"初始状态"})})]})},f=function(n){var e=(0,a.lazy)(function(){var e=n().then(function(n){return(0,p._v)(2e3).then(function(){return n})});return p.AP.start(),e.finally(function(){p.AP.done()}),e});return(0,r.jsx)(e,{})},x=f(function(){return t.e(1270).then(t.bind(t,1270))}),g=f(function(){return t.e(1854).then(t.bind(t,1854))}),j=f(function(){return t.e(6093).then(t.bind(t,6093))}),y=function(n){return"/page-1"===n.pathname?x:"/page-2"===n.pathname?g:"/page-3"===n.pathname?j:(0,r.jsx)("span",{children:"切换路由时注意浏览器上方会有进度条显示"})},v=function(){var n=(0,i._)((0,a.useState)("/"),2),e=n[0],t=n[1],s=(0,i._)((0,a.useTransition)(),2)[1],l=(0,a.useCallback)(function(n){s(function(){t(n)})},[]);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(o.ZP,{onClick:function(){return l("/page-1")},type:"/page-1"===e?"primary":"text",children:"页面1"}),(0,r.jsx)(o.ZP,{onClick:function(){return l("/page-2")},type:"/page-2"===e?"primary":"text",children:"页面2"}),(0,r.jsx)(o.ZP,{onClick:function(){return l("/page-3")},type:"/page-3"===e?"primary":"text",children:"页面3"})]}),(0,r.jsx)("hr",{}),(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("span",{children:"loading..."}),children:(0,r.jsx)(y,{pathname:e})})]})},w=t(5685),S=!0,C={title:"useTransition",description:"React 18 Hooks useTransition",tag:["react","web前端"],updated:"2023-02-22T07:57:53.000Z"},k="useTransition",b="React 18 Hooks useTransition",T=["react","web前端"],P="2023-02-22T07:57:53.000Z",N=function(n){return(0,r.jsx)(w.s,n)};function E(n){var e=Object.assign({h1:"h1",h2:"h2",pre:"pre",code:"code",p:"p",blockquote:"blockquote"},(0,s.ah)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"示例一",children:"示例一"}),"\n",(0,r.jsx)(e.h2,{id:"代码",children:"代码"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { FC, memo, ReactNode, useRef, useState, useTransition } from 'react';\nimport { Button } from 'antd';\n\ninterface SlowItemProps {\n  children?: ReactNode;\n}\nconst SlowItem: FC<SlowItemProps> = (props) => {\n\n  const { children } = props;\n  const now = useRef(Date.now());\n\n  while (Date.now() - now.current < 10) {\n    // 强行阻塞代码10毫秒\n  }\n\n  return (\n    <span>{ children }</span>\n  );\n};\n\nconst SlowList = memo(() => {\n  return (\n    <>\n      {\n        // 循环200次就是阻塞2秒钟\n        new Array(200).fill(1).map((v, k) => {\n          return (\n            <SlowItem key={k}>{ k }</SlowItem>\n          );\n        })\n      }\n    </>\n  );\n});\nSlowList.displayName = 'SlowList';\n\nconst UseTransitionList: FC = () => {\n\n  const [show, setShow] = useState(false);\n  const [isPending, startTransition] = useTransition();\n\n  return (\n    <div>\n      <div>\n        <Button onClick={() => setShow(true)}>展示列表(同步渲染)</Button>\n        <span>同步的按钮点击后，rerender过程同步执行，所以浏览器会卡死5秒钟</span>\n      </div>\n      <div>\n        <Button\n          onClick={() => {\n            startTransition(() => setShow(true));\n          }}\n        >展示列表(startTransition)</Button>\n        <span>{ `${isPending}` }</span>\n        <Button onClick={() => setShow(false)}>隐藏列表</Button>\n        <span>使用startTransition，rerender过程异步执行，可以随时中断rerender过程</span>\n      </div>\n      {\n        show ?\n          <SlowList /> :\n          null\n      }\n    </div>\n  );\n};\n\nexport { UseTransitionList };\n"})}),"\n",(0,r.jsx)(e.h2,{id:"效果",children:"效果"}),"\n",(0,r.jsx)(u,{}),"\n","\n",(0,r.jsx)(e.h1,{id:"示例二与suspense配合食用",children:"示例二（与Suspense配合食用）"}),"\n",(0,r.jsx)(e.h2,{id:"代码-1",children:"代码"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { FC, lazy, Suspense, useState, useTransition } from 'react';\nimport { sleep } from '@shared/utils';\nimport { Button, Space } from 'antd';\n\n// 将lazy组件再延迟2000毫秒以便更好的模拟网络延迟\nconst LazyExample = lazy(() => import('./lazy-example').then(res => sleep(2000).then(() => res)));\n\nconst SuspenseExample: FC = () => {\n\n  const [show, setShow] = useState(false);\n  const [isPending, startTransition] = useTransition();\n\n  return (\n    <>\n      <div>\n        <Space>\n          <Button onClick={() => setShow(true)}>显示</Button>\n          <Button onClick={() => setShow(false)}>隐藏</Button>\n          <Button\n            onClick={() => {\n              startTransition(() => setShow(true));\n            }}\n          >显示（startTransition）</Button>\n          <span>{`${isPending}`}</span>\n        </Space>\n      </div>\n      <hr />\n      <Suspense fallback={<span>loading...</span>}>\n        {\n          show ?\n            <LazyExample /> :\n            <span>初始状态</span>\n        }\n      </Suspense>\n    </>\n  );\n};\n\nexport { SuspenseExample };\n"})}),"\n",(0,r.jsx)(e.h2,{id:"效果-1",children:"效果"}),"\n",(0,r.jsx)(m,{}),"\n",(0,r.jsx)("hr",{}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.code,{children:"可以看到，使用startTransition时，Suspense的fallback没有生效，在异步组件加载完成之前，页面UI始终没有变化"})}),"\n",(0,r.jsx)(e.h2,{id:"应用场景",children:"应用场景"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"懒加载路由进度条"}),"\n"]}),"\n","\n",(0,r.jsx)(v,{}),"\n",(0,r.jsx)(e.h2,{id:"代码模拟异步加载的路由场景",children:"代码（模拟异步加载的路由场景）"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-tsx",children:"import { ComponentType, FC, lazy, LazyExoticComponent, Suspense, useCallback, useState, useTransition } from 'react';\nimport { Button } from 'antd';\nimport { sleep, NProgress } from '@shared/utils';\n\nconst AsyncLoad = <T extends ComponentType>(factory: () => Promise<{default: T}>) => {\n  const C = lazy(() => {\n    const load = factory().then(res => sleep(2000).then(() => res));\n    NProgress.start();\n    load.finally(() => {\n      NProgress.done();\n    });\n    return load;\n  }) as LazyExoticComponent<any>;\n  return (\n    <C />\n  );\n};\n\nconst Router1 = AsyncLoad(() => import('./router-1'));\nconst Router2 = AsyncLoad(() => import('./router-2'));\nconst Router3 = AsyncLoad(() => import('./router-3'));\n\nconst Routes: FC<{ pathname: string }> = (props) => {\n  if (props.pathname === '/page-1') {\n    return Router1;\n  }\n  if (props.pathname === '/page-2') {\n    return Router2;\n  }\n  if (props.pathname === '/page-3') {\n    return Router3;\n  }\n  return <span>切换路由时注意浏览器上方会有进度条显示</span>;\n};\n\nconst LazyProgress: FC = () => {\n  const [pathname, setPathname] = useState('/');\n\n  const [, startTransition] = useTransition();\n  const navigate = useCallback((url: string) => {\n    startTransition(() => {\n      setPathname(url);\n    });\n  }, []);\n\n  return (\n    <div>\n      <div>\n        <Button onClick={() => navigate('/page-1')} type={pathname === '/page-1' ? 'primary' : 'text'}>页面1</Button>\n        <Button onClick={() => navigate('/page-2')} type={pathname === '/page-2' ? 'primary' : 'text'}>页面2</Button>\n        <Button onClick={() => navigate('/page-3')} type={pathname === '/page-3' ? 'primary' : 'text'}>页面3</Button>\n      </div>\n      <hr/>\n      <Suspense fallback={<span>loading...</span>}>\n        <Routes pathname={pathname} />\n      </Suspense>\n    </div>\n  );\n\n};\n\nexport { LazyProgress };\n"})})]})}var B=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.jsx)(N,Object.assign({},n,{children:(0,r.jsx)(E,n)}))}},3121:function(n){"use strict";n.exports=ReactTransitionGroup},9378:function(n){"use strict";n.exports=algoliasearch},7513:function(n){"use strict";n.exports=rxjs}},function(n){n.O(0,[9894,2128,3554,5685,9774,2888,179],function(){return n(n.s=5641)}),_N_E=n.O()}]);