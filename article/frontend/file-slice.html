<!DOCTYPE html><html lang="zh-cn"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="renderer" content="webkit"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><title>前端大文件切片上传 - Chicken Man</title><meta name="description" content="将文件切片后上传，可以实现断点续传、暂停、秒传等操作"/><meta name="og:title" content="前端大文件切片上传 - Chicken Man"/><meta name="og:description" content="将文件切片后上传，可以实现断点续传、暂停、秒传等操作"/><meta name="og:image" content="/favicon.ico"/><meta name="docsearch:tags" content="web前端"/><meta name="next-head-count" content="11"/><link rel="stylesheet" href="//unpkg.com/@primer/css@20.4.2/dist/markdown.css"/><link rel="stylesheet" href="//unpkg.com/nprogress@0.2.0/nprogress.css"/><link rel="preload" href="/_next/static/css/9c78843cfdd0bbe8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9c78843cfdd0bbe8.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9172c27af8c24be7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9172c27af8c24be7.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="//unpkg.com/react@18.2.0/umd/react.production.min.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/rxjs@7.5.7/dist/bundles/rxjs.umd.min.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/immutable@4.1.0/dist/immutable.min.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/react-transition-group@4.4.5/dist/react-transition-group.min.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/moment@2.29.4/min/moment.min.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/moment@2.29.4/locale/zh-cn.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/nprogress@0.2.0/nprogress.js" defer="" data-nscript="beforeInteractive"></script><script src="//unpkg.com/algoliasearch@4.17.0/dist/algoliasearch.umd.js" defer="" data-nscript="beforeInteractive"></script><script src="/_next/static/chunks/webpack-d7cf4c28af3aac4f.js" defer=""></script><script src="/_next/static/chunks/framework-477235ca0e317f29.js" defer=""></script><script src="/_next/static/chunks/main-14e88bb39ac8bbca.js" defer=""></script><script src="/_next/static/chunks/pages/_app-428d289f0eeed35d.js" defer=""></script><script src="/_next/static/chunks/9894-82281c70dc11a0f7.js" defer=""></script><script src="/_next/static/chunks/2128-a65392031df0ed75.js" defer=""></script><script src="/_next/static/chunks/3554-ba023821f799e056.js" defer=""></script><script src="/_next/static/chunks/5685-8b0003e76e6203ea.js" defer=""></script><script src="/_next/static/chunks/pages/article/frontend/file-slice-ea549111aca04b1b.js" defer=""></script><script src="/_next/static/Et3Eh7KhzAnAHs04rI1Yw/_buildManifest.js" defer=""></script><script src="/_next/static/Et3Eh7KhzAnAHs04rI1Yw/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section><header class="styles_header___Ivmm"><nav><div class="styles_nav-list__UoHzq"><a href="/">首页</a><a href="/tag">我的笔记</a><a href="/use-modal-service" target="_blank" title="更简单的使用antd modal">useModalService</a><a href="/bello" target="_blank" title="基于antd的表单差异对比组件">bello</a><a href="/about">关于我们</a></div></nav><label class="search_search-box__K2yMn"><input placeholder="搜索..." class="ant-input css-1wazalj" type="text" value=""/></label></header><main class="styles_main__TpZ7Y styles_article-main__Y0Jle"><article class="sc-65c4189e-1 QBdmI"><h1 class="article-title">前端大文件切片上传</h1><p><span>更新时间：<!-- -->2023-02-22 15:57:53</span><span><span>标签：</span><a href="/list/web%E5%89%8D%E7%AB%AF"><span class="ant-tag css-1wazalj">web前端</span></a></span></p><div class="sc-65c4189e-0 bWLCPr markdown-body"><h2 class="sc-30bed449-0 haWXgw" id="浏览器端">浏览器端<a href="#浏览器端"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<h3 class="sc-30bed449-0 haWXgw" id="文件切片和md5值计算">文件切片和MD5值计算<a href="#文件切片和md5值计算"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<div class="sc-871efcea-0 jzhkOl"><pre class="sc-9e1f24c-0 bFyNcM prism-code language-typescript" style="color:#393A34;background-color:#f6f8fa"><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">1</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SparkMD5 </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;spark-md5&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">2</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Observable </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rxjs&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">3</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain" style="display:inline-block">
</span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">4</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">SlicedFile</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">5</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">  md5</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">6</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">  chunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Blob</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">7</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">8</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain" style="display:inline-block">
</span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">9</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fileSlice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> File</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sliceSize</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token comment" style="color:#999988;font-style:italic">/* byte */</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">10</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token class-name operator" style="color:#393A34">&lt;</span><span class="token class-name punctuation" style="color:#393A34">[</span><span class="token class-name builtin">number</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name"> SlicedFile </span><span class="token class-name operator" style="color:#393A34">|</span><span class="token class-name"> </span><span class="token class-name keyword" style="color:#00009f">null</span><span class="token class-name punctuation" style="color:#393A34">]</span><span class="token class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subscriber </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">11</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> spark </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SparkMD5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">12</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> maxCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ceil</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> sliceSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">13</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> chunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Blob</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">14</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fileReader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">15</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    fileReader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">onload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">16</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      spark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">result </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> ArrayBuffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">17</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token function" style="color:#d73a49">loadNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">18</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">19</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    fileReader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">onerror</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">20</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">21</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">22</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">loadNext</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">23</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> maxCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">24</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> chunks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> sliceSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">25</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">26</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> sliceSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">27</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> blob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">28</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        fileReader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readAsArrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">29</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        chunks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">30</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">31</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> md5</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> spark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chunks </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">32</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        subscriber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">33</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">34</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">35</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token function" style="color:#d73a49">loadNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">36</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">37</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token function" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">38</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">        fileReader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">abort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">39</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">40</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">41</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">42</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></div></pre></div>
<!-- -->
<div style="padding:20px 0"><input type="file"/></div>
<h3 class="sc-30bed449-0 haWXgw" id="上传过程">上传过程<a href="#上传过程"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<div class="sc-871efcea-0 jzhkOl"><pre class="sc-9e1f24c-0 bFyNcM prism-code language-javascript" style="color:#393A34;background-color:#f6f8fa"><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">1</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token comment" style="color:#999988;font-style:italic">/**</span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">2</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token comment" style="color:#999988;font-style:italic"> * @type {SlicedFile}</span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">3</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">4</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> slicedFile</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">5</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">6</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> slicedFile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">chunks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">7</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> formData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">8</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    formData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;file&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slicedFile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">chunks</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">9</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/upload?md5=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">slicedFile</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">md5</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&amp;index=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">i</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">10</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> formData</span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">11</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">12</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span></div><div class="sc-9e1f24c-1 ducWqU token-line" style="color:#393A34"><span class="sc-9e1f24c-2 cckslz">13</span><span class="sc-9e1f24c-3 kQYsNu"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></div></pre></div>
<h3 class="sc-30bed449-0 haWXgw" id="暂停上传">暂停上传<a href="#暂停上传"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>前端中断顺序上传过程的行为即为暂停，上传进度为最后一次上传成功的切片</p>
<h3 class="sc-30bed449-0 haWXgw" id="继续上传">继续上传<a href="#继续上传"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ol>
<li>服务端需要提供一个接口，接收参数为md5，前端通过此接口查询该md5对应的文件是否处于暂停中的状态；</li>
<li>如果查询到该md5对应的文件处于暂停状态，则返回前端当前暂停处于第几个切片；</li>
<li>前端从该切片开始，继续上传任务；</li>
</ol>
<h3 class="sc-30bed449-0 haWXgw" id="文件秒传">文件秒传<a href="#文件秒传"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ol>
<li>前端根据md5值，通过后端接口查询该md5值对应文件的存储状态；</li>
<li>如果查询到该文件已经存在于文件服务器，则直接展示文件链接（根据业务需求）；</li>
</ol>
<h2 class="sc-30bed449-0 haWXgw" id="服务端">服务端<a href="#服务端"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<h3 class="sc-30bed449-0 haWXgw" id="建立一个临时文件夹名称为用户上传文件的md5">建立一个临时文件夹，名称为用户上传文件的md5<a href="#建立一个临时文件夹名称为用户上传文件的md5"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>例如：</p>
<ul>
<li>518798f72fea56abae47a08e0b363021（文件夹名，md5值）<!-- -->
<ul>
<li>0（第一个切片）</li>
<li>1（第二个切片）</li>
<li>2（第三个切片）</li>
<li>3（第四个切片）</li>
<li>...</li>
</ul>
</li>
</ul>
<h3 class="sc-30bed449-0 haWXgw" id="用户暂停上传">用户暂停上传<a href="#用户暂停上传"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ol>
<li>保留该上传任务的临时文件夹及所有已完成上传的切片文件；</li>
<li>可以在数据库记录当前文件的上传状态（比如暂停中），uniqueID取md5；</li>
</ol>
<h3 class="sc-30bed449-0 haWXgw" id="用户继续上传">用户继续上传<a href="#用户继续上传"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ol>
<li>查询该md5对应的文件状态是否为暂停中；</li>
<li>继续接收用户上传的切片；</li>
</ol>
<h3 class="sc-30bed449-0 haWXgw" id="用户上传成功">用户上传成功<a href="#用户上传成功"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ol>
<li>所有切片完成上传后，合并所有切片，并校验md5值；</li>
<li>存储到服务器，并更新数据库状态；</li>
</ol>
<h3 class="sc-30bed449-0 haWXgw" id="文件秒传-1">文件秒传<a href="#文件秒传-1"><svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" fill="currentColor" class="anchor"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ol>
<li>数据库保存某个文件的md5及该文件的存储状态（比如上传成功）；</li>
<li>提供md5查询接口，前端根据md5查询某个文件是否存在，若存在则返回文件链接（根据业务需求）；</li>
</ol></div></article></main></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"前端大文件切片上传","description":"将文件切片后上传，可以实现断点续传、暂停、秒传等操作","tag":["web前端"],"updated":"2023-02-22T07:57:53.000Z"}},"__N_SSG":true},"page":"/article/frontend/file-slice","query":{},"buildId":"Et3Eh7KhzAnAHs04rI1Yw","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>